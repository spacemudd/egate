Cloud online dual channel access control controller ? Plus B Edition ? Supports facial recognition HTTP Interface Protocol This agreement is a confidential document and may not be copied or sent to other personnel without permission. If you are unable to maintain the security of this file, please delete it. This agreement applies to online access controllers! Please note that all markings are defined as follows:A represents IN, which is the direction of entry, B represents OUT as the direction of departure date update 2023-04-11 Supports LCD QR code display 2021-10-27Version 3 firmware: Controller with USB port function, changed ID and facial data types, supports TCP capture machine. Photos are not compatible! 2019-07-06 Support heartbeat return to display on specified screens, optimize code, and add protocol corresponding function descriptions 2019-06-14 Support screen display page selection, field LCD 2019-01-14 
working principle     After swiping the card on the access control controller, it is transmitted in real-time to the backend server. The server processes the received data and responds to the controller. The controller responds accordingly, such as opening the door. Network communication between devices and servers must be maintained, and TCP, UDP, and HTTP protocols can be used. This document is the HTTP protocol.      After swiping the card, the controller submits an HTTP request to the server. After the server responds, the controller executes the action. The development engineer needs to implement the server-side. 1? Steps 1. Change the computer IP and controller to the same network segment, usually 192.168.0.X.2. Open the IP address of the controller using a browser and log in to the account admin 888888. It is recommended to use the browser Chrome. 3. Enter the network settings interface and modify parameters such as network address as needed. Modify the server IP, port, and URL for HTTP. If the server address is a domain name, you need to check "Address is a domain name" and fill in the DNS server IP correctly. 4. Enable HTTP communication function. 5. Establish an IIS service using the HTTP folder in the demo and test it using a browser.6. Start a network packet capture tool (such as Ethereal) to capture packets and observe heartbeat and card swiping data. 7. Read the documentation of this development package in detail and proceed with the development. 8. After the development is completed, decide whether to enable AES128 encryption function. The minimum project needs to be completed: heartbeat data reception and response, access control data reception and response. Key point: During the development process, use network packet capture tools to capture software communication data, compare and check for incorrect communication packet data. be careful:All received and sent strings are case sensitive! The response should be a standard JSON string with double quotes, and the entire response packet should not exceed 760 bytes (including the HTTP header). It can be sent in up to 2 TCP network packets without any extra spaces. The multi byte text sent consists of 2 bytes. 
Restriction Table function limit Card number length 4-byte integer password5-8 digits, if not enough, press #, can customize up to 12 digits AES encryption 128 bit Response card number 16 bytes, used for LCD board display Response Name 16 bytes, used for LCD board display Response time20 bytes, used for LCD board display Response event 32 bytes, used for LCD board display Response voice 40 bytes, used for voice board playback 
Overview of HTTP Protocol      The server only needs to complete 2 interfaces to achieve access control function.1. Heartbeat interface, the controller submits a request to the server every 5 seconds (default), and the server can obtain whether the device is online and some status information, such as on, input, temperature and humidity. The server can determine if the device is functioning properly and needs to respond. 2. Access control request interface; Every time someone needs to pass, swiping the card (or other means) submits an access control request to the server. The server makes authorization judgments based on the obtained data, returns the judgment results to the controller, and the controller takes corresponding actions. Protocol functions supported by the controller Number project length(byte) Serial port Base64 GET POST GET encryption POST encryption one heartbeat one hundred Ã Ã Ã Ã two card 4 bytes Ñ ÃÃ Ã Ã three password 8 characters Ñ Ã Ã Ã Ã four QR code three hundred and twenty Ã URL JSON DATAS DATAS seven fingerprint five hundred and twenty-eight Mandatory URLJSON DATAS DATAS eight Digital vein two thousand and forty-eight Ã Ñ JSON+VEIN=Binary Ñ JSON+VEIN=Binary nine RFID one thousand and twenty-four URLJSON DATAS DATAS eleven Facial 23 70K Ã Ñ JSON Ñ Ñ twelve Json 28 Ñ Ã Ñ Ñ 
Heartbeat request structure GET modeGET  /data/Acs.aspx?method=GetStatus&Now=2018060217181207&Crc=65535&T1=00& H1=00&T2=00&H2=00&NextNum=0&Key=23685&Index=11571&Serial=R12034&Status=03&Input=0000&Ver=135&ID=R12034&MAC=0004A33CCCB2&Modbus=AAAAAAAAAAAAAAAAAAA= HTTP/1.1 Host:192.168.1.230:84 User-Agent: Chrome/61.0.3163.100 Safari/537.36 Content-Type: application/json Connection: keep-Alive 	    POST mode POST /data/Acs.aspx? method=GetStatus& HTTP/1.1Host:192.168.1.230:84 User-Agent: Chrome/61.0.3163.100 Safari/537.36 Content-Type: application/json Content-Length: 222 Connection: keep-Alive {"Serial":"R12034","Status":"03","Input":"0000","Ver":"135","ID":"R12034","IP":"192.168.3.34","MAC":"0004A33CCCB2","Now":"2018060217171607","Crc":"65535","T1":"00","H1":"00","T2":"00","H2":"00","NextNum":"0","Key":"26728","Modbus":"AAAAAAAAAAAAAAAAAAA="}The heartbeat function is a request that the controller actively sends to the server after a certain interval of time (default 5 seconds) or when the controller undergoes a state change. The server can know the device's data and input/output status, as well as whether the device is online. The heartbeat function can be selected to be turned off. 
Request structure for access control GET mode GET /data/Acs.aspx? method=SearchCardAcs&type=9&Reader=1&DataLen=24&Index=15319&Serial=R12034&Status=03&Input=0000&Ver=135&ID=R12034&MAC=0004A33CCCB2&Card=ODIwNDM0MjE3NDQwMDIwNA== HTTP/1.1 Host:192.168.1.230:83 User-Agent: Chrome/61.0.3163.100 Safari/537.36 Content-Type: application/json Connection: keep-Alive 	    POST mode POST /data/Acs.aspx? method=SearchCardAcs HTTP/1.1 Host:192.168.1.230:83 User-Agent: Chrome/61.0.3163.100 Safari/537.36Content-Type: application/json Content-Length: 1133 Connection: keep-Alive{"type":"10","Reader":"1","DataLen":"952","Index":"1979","Serial":"R12034","Status":"03","Input":"0000","Ver":"135","ID":"R12034","IP":"192.168.3.34","MAC":"0004A33CCCB2","Card" : "S4dTUzIxAAACxMgECAUHCc7QAADixCEBAAAAgmkSmsQtAB4PxgD1AKLLygBQAKIPmgBhxBUOpABnAGUPysSSADIPRABcAHHJUgCfAIQNbQCdxKwPTgCyAI4NLsSyAGUORwALAEzKtQDzAL0P4AD1xAMPDgACAcEPTcQCAa4OlADPAbTLUwATAZwPooCZR35/GgBnhP4DmMBLB3uHw6Nyk3GzzwMf9gdyB4X1UhKTHfA9K6sRj9RIOWojxn1WDg03AMnl24H/3x34MT8a/QfW6jrMKM5+E4+P7QJPV5WtaAZ/W4tryBRca45isvpHH5YLnzR+nePru1jHICzFAMsW2gQAZwkejgcAtgUgwDpGBsTCBiLA/wXFlAvTNgYAqwYeBT4IxIYMFsD//wXALcIBWA8JQcHMAHDKDkZEwBEAiRUOBMD9wP7/wAXA/TtG/xIARR7MwMI6/sA2PsE/Og8C+icDP0A1UzoKAvIsA/9LPf/NAJ7oG0xHCQCZ9SDCBEs4BADJM+JVCMQ0NQZKMELQACyE/C/A/v5DO//9+sH/SwUAJo/9/QT8EABgTRAFK/07/v1YRg0A2lX4hUrAKMAGANJh9YX+DgBjYhA7wf6I/jJWDwBiohdJOkFF/2wKAGJrJYXAPsAWAA+r9EQ5/iv+NT5iSRMCyXnwNf4u/+z+wgVQFQAIhPCE//zj//7+wf9nBH8RxAqP6/47/Tgq/I7AwnsFAMxQLTzCAceWN8FEwwBC XXXBwWkHAJablQDFwnMHAE9lgMcEYxIACZvrOv7DP//7//3//a/CdM8BVqMr/TIEksPOAVSpPTeGQgcChLNXwP//+zoEAu23Z1YHAEMVU8I+/jYEAEnSjJsExArY7cLCT80AS3RSU/wnBQDv9gE//8AGEBEAMv3/8QcQEQYD/+4FEsgMCcBAUkLFC0HFAQALRVIAayMBAA=="}When a traffic request occurs, the request data will be submitted to the server. Possible requests include: swipe card, password, fingerprint, finger vein, QR code, ID card, face, and button. 
* Access control GET plaintext request Card, password /data/Acs.aspx? method=SearchCardAcs&type=0&Reader=0&DataLen=1024&Index=4681&Serial=R12034&Status=03&Input=0000&Ver=135&ID=R12034&MAC=0004A33CCCB2 &Card=123456QR code, fingerprint, RFID /data/Acs.aspx? Method=SearchCardAcs&type=1&Reader=0&DataLen=1024&Index=4681&Serial=R12034&Status=03&Input=0000&Ver=135&ID=R12034&MAC=0004A33CCCB2&Card=Base64 encoded data * Access control POST plaintext request Card, password{"type":"0","Reader":"1","DataLen":"24","Index":"8938","Serial":"R12034","Status":"03","Input":"0000","Ver":"135","ID":"R12034","IP":"192.168.3.34","MAC":"0004A33CCCB2","Card":"1258741"} 	QR code, fingerprint, RFID {"Type": "1", "Reader": "1", "DataLen": "24", "Index": "8938", "Serial": "R12034", "Status": "03", "Input": "0000", "Ver": "135", "ID": "R12034", "IP": "192.168.1.34", "MAC": "0004A33CCCB2", "Card": "Base64 encoded data"} Face{"type": "13", "Reader": "1", "DataLen": "24", "Index": "8938", "Serial": "R12034", "Status": "03", "Input": "0000", "Ver": "135", "ID": "R12034", "IP": "192.168.1.34", "MAC": "0004A33CCCB2", "Card": "0"} FACE=Facial photo binary data Digital vein{"type": "11", "Reader": "1", "DataLen": "24", "Index": "8938", "Serial": "R12034", "Status": "03", "Input": "0000", "Ver": "135", "ID": "R12034", "IP": "192.168.1.34", "MAC": "0004A33CCCB2", "Card": "0"} VEIN=Facial photo binary data 
* Access control GET encryption request Card, password, QR code, fingerprint, RFID, ID card (excluding photos)/data/Acs.aspx? Method=SearchCardAcs&DATAS=Data encrypted and then BASE64 encoded HTTP/1.1 Finger vein and face: GET not supported* Access control POST encryption request Card, password, QR code, fingerprint, RFID, ID card (excluding photos) POST /data/Acs.aspx? method=SearchCardAcs HTTP/1.1 Host:192.168.1.230:83 User-Agent: Chrome/61.0.3163.100 Safari/537.36 Content-Type: application/json Content-Length: 1133 Connection: keep-AliveDATAS=JSON data encrypted and then BASE64 encoded 	Digital veinDATAS=JSON data encrypted and then BASE64 encoded VEIN=binary finger vein data Face DATAS=JSON data encrypted and then BASE64 encoded FACE=binary facial data All access control request responses have the same structure. 
* Heartbeat requestField description (case sensitive): field explain Serial The serial number of the device ID Please set the custom identifier for the device in the WEB interface. Key The key value sent, the server needs to return the original value OrderCodeThe order number of the requested business is used to pass through the verification function of the ticket. The server responds with this value and returns it to the server in the heartbeat, allowing the server to know which order data this time belongs to. Status Current door status, hexadecimal value Bit6 input relay output; Bit7 output relay;Bit4 lock in; Bit5 output lock; Bit2 alarm relay output; Bit1 exit status - if the door magnet and relay are both closed, it indicates that they are closed;Bit0 entry status - if both the door magnet and relay are closed, it indicates that they are closed; 1 on 0 off Input Input status hexadecimal value Bit11 reset button Bit10 anti disassembly Bit6-9 Extended Input 1-4Bit5 fire alarm input Bit4 alarm input Bit2-3 Gate Magnets 1-2 Bit0-1 button 1-2 Now Current device time: The first 14 bytes in format: yyyyMMddHHmmssThe last two bytes represent the week, which starts from Sunday and is 01 Index Random value Ver Detailed firmware version WillPassWhen multiple people pass through a single card swipe, there are still a few people who need to pass. PassedWhen multiple people pass through a single card swipe, several people have already passed MAC MAC address of the device Modbus The data collected from Modbus devices can be found in the Modbus instructions.  	Remarks:  Bit is a binary bit, not a byte, a byte is a byte. To determine whether a certain binary bit is 1: use the formula 0xAB&(0x01<<b)==0x01<<b, where b is the number of binary bits to be determined, and 0xAB is the value obtained from the heartbeat, such as the data corresponding to Status: "AB".   Group ticket function (one ticket has too many people)  Select input as detection mode on the parameter interface of the controllerSingle detection: indicates that only one switch input is needed for each person passing by. MSGA-MSGB is used for direction control, and two infrared switch inputs are installed. After triggering A, B is triggered, indicating that the person has passed. One ticket with multiple people: After swiping the card, HTTP returns the Times parameter from the server to indicate how many people have passed. Every time an input is triggered, the controller will automatically continue to activate it once for the convenience of the next person to pass through.The heartbeat record includes WillPass and Passed sent to the server. The server has obtained the number of passes. If it times out, the gate will automatically cancel all failed records, and the timeout time will be configured on the web interface. For specific functions, please refer to the document "Summary of Judging Traffic Functions"  
 Server response Clear text:HTTP/1.1 200 OK Cache-Control: private Content-Type: text/html; ..Date: Tue, 05 May 2016 08:32:33 GMT Content-Length:16....DATA={ ÒKeyÓ:Ò543210Ó,ÒNowÓ:Ò201611261517376Ó} Cryptography:HTTP/1.1 200 OK Cache-Control: private Content-Type: text/html; ..Date: Tue, 05 May 2016 08:32:33 GMT Content-Length:40....DATAS={0B5981B8621B564625757DEFE0C19597} A's simplest response field explain Key Required parameter, received Key valueB Response - On field explain Key Required parameter, received Key value AcsRes Optional parameters: 0 reject, 1 open, 2 alarm, 3 close ActIndexOptional parameters, action position, relay position, 0-2 Time Optional parameter, relay action time, which is the number of seconds the relay remains active. C Response - Display Voice field explain Key Required parameter, received Key value ReaderOptional parameters, direction selection, such as entering and exiting the screen, prompting for head reading, etc. 2019-07-05 LCD Optional parameters, pass=6, invalid=7, standby=0, screen display page, none indicates control by the controller itself. 2019-06-14 LCDTimeOptional parameters, numeric characters, duration of screen display, in seconds 2019-07-05 Name Optional parameters, name, displayed on LCD screen, less than 16 bytes Note Optional parameters, event description, displayed on LCD screen, less than 32 bytesCard Optional parameter, card number string, displayed on LCD screen, less than 16 bytes Systime Optional parameters, time, displayed on LCD screen, less than 20 bytes Voice Optional parameter, voice string, used for broadcasting, less than 40 bytesQRCode Optional, QR code displayed on LCD, less than 120 bytes, supported on April 11, 2023, version 177 D response - synchronization time Key Required parameter, received Key value NowOptional parameters. You can compare the system and receiving device time, and add this field if there is a significant error. The first 14 bytes are formatted as yyyyMMddHHmmss The last byte is the week, which starts from Sunday and is 0 on Sunday The access control controller submits this heartbeat request every 5 seconds or if there is a change in status (output changes), and the server needs to respond.
All fields of the response field explain Key Required parameter, received Key value Now Optional parameters. You can compare the system and receiving device time, and add this field if there is a significant error. The first 14 bytes are formatted as yyyyMMddHHmmssThe last byte is the week, which starts from Sunday and is 0 on Sunday AcsRes Optional parameters: 0 reject, 1 open, 2 alarm, 3 close, 4 ignore ActIndex Optional parameters, action position, relay position, 0-2 TimeOptional parameter, relay action time, which is the number of seconds the relay remains active. Reader Optional parameters, direction selection, such as entering and exiting the screen, prompting for head reading, etc. 2019-07-05 LCD Optional parameters, screen display page, no indication controlled by the controller itself. 2019-06-14 LCDTimeOptional parameter, screen display time 2019-07-05 Name Optional parameters, name, displayed on LCD screen, less than 16 bytes Note Optional parameters, event description, displayed on LCD screen, less than 32 bytes CardOptional parameter, card number string, displayed on LCD screen, less than 16 bytes Systime Optional parameters, time, displayed on LCD screen, less than 20 bytes Voice Optional parameter, voice string, used for broadcasting, less than, less than 40 bytes QRCodeOptional, QR code displayed on LCD, less than 120 bytes, supported on April 11, 2023, version 177 OEM Customized customer code, if not, this field is not requiredNote: The encrypted returned string must conform to the structure DATAS={0B5981B8621B564625757DEFE0C19597}, and the hexadecimal string must be the encrypted value of {"Key": "543210", "Now": "201611261517376"}.        By adding fields to the heartbeat response, it is possible to activate the device during heartbeat, enabling remote switching or display, as well as voice broadcasting operations.     
Access control request Description (case sensitive) field Remarks Card Received card number, password, QR code, social security card, string type,Alarm value when type=5 When type=28, Card is a JSON object type Received data type  0 = Card 1 = QrCode from 232( Not recommended) 2 =PIN 3=Button request;  5=alarm information; 9 = Base64 data, QrCode; (recommended)10=fingerprint data; 11=Finger vein data; 12=RFID card;13 or 23=face; 16. The device selected by the customer, the data phase after base64, when type=9 (2024-05-17)17 continuous transmission of 232 data, suitable for continuous data from long-distance reading heads. ?2024-05-23? Post data pushed by 28 facial recognition machines (person ID comparison, ID card push) The data generated by the 30 read head (block data of WG66/sector) is multi byte data and can only be sent online.31 Social Security Card Source  The data source for this real-time request (starting from 4.2.127 on November 10, 2023) includes the following items:  0=WG reader; 1=RS232 interface; 2=485 interface; 5=USB interface;6=232 conversion board; 7=Controller button; 9=Network Serial Controller serial number, used to distinguish devices. ID Custom identifier (default to Serial), can be modified in the web interface to distinguish devices. Maximum of 10 char charactersReader Reading head, 0=in, 1=out, used to identify the direction of entry and exit Status Current gate state, hexadecimal value string. Bit0 gate status - if both the gate magnet and relay are closed, it indicates that they are closed; Bit4 relay output Index Random valueMAC The MAC address of the device consists of 12 hexadecimal strings, for example, 0004A33CCCB2. Name Hexadecimal string, name, ID information Unicode encoding, not exceeding 12 bytes When Type=31 social security card, use GBK codeIf it is a QR code, it is strongly recommended to use BASE64 to prevent server crashes caused by the GET protocol.   Note: In version 3 of the firmware, the ID card type has been changed to 26, and only the ID card photo data is base64; The facial data type has been changed to 23 
Server response Clear text:HTTP/1.1 200 OK Cache-Control: private Content-Type: text/html; .Date: Tue, 05 May 2015 08:32:33 GMT Content-Length:210...DATA={"Card":"4238669","Systime":"2017-01-18 11:47:09","Voice":"........,........","ActIndex":"0","AcsRes":"1","Time":"1","Note":"..........................","Name":"................"} Cryptography:HTTP/1.1 200 OK Cache-Control: private Content-Type: text/html; .Date: Tue, 05 May 2015 08:32:33 GMT Content-Length:710...DATAS={2B6D5851B9D6B67ACE56FB3319BA6EE7B7D865049851587D4F56CB62D9BF605D8CD429C9874CF86119066087FC76E1D14AC37098352183F12B7E12261BCABD69F16B4B4EC679A1AEECFA7433E031B6889BBC36C45BBC12F824311AAC354E0A34B2C976834AB4377D09481461D93D06F17429FF1068C19A0898A65732CD9F60A808BAA1455FBAFF275A4413BC55AC4D49E6DE47441C8C3C633B2ECBC1EDB29979ADC1075CE3FBD3A7906D27DF8C0FF412C3F4D8A45DFC8C51BE569F4918DD55F749431AC6D4185D3999D7292260921C41B11960DF546F59C363443B3E570567F3F83302B80B8BA91A3B2675F899C5A3E9}The description of each field is as follows (mandatory parts in red): field explain AcsRes Processing results: 1 open, 2 alarm, 3 close, 0 reject ActIndexAction position, relay position, 0-2, 0: in, 1: out, 2: alarm Time The action time of the relay, which is the number of seconds the relay remains in action. LCD Optional parameters, screen display page, no indication controlled by the controller itself. 2019-06-14 LCDTimeOptional parameter, screen display time 2019-07-05 Name Optional parameters, name, displayed on LCD screen, less than 16 bytes Note Optional parameters, event description, displayed on LCD screen, less than 32 bytes CardOptional parameter, card number string, displayed on LCD screen, less than 16 bytes Systime Optional parameters, time, displayed on LCD screen, less than 20 bytes Voice Optional parameter, voice string, used for broadcasting, less than 40 bytes QRCodeOptional, a QR code displayed on the LCD, with a maximum of 120 bytes, supported on April 11, 2023, version 177 Times How many people are allowed to pass this time, 2-250, if not, it means passing through one person.If this field is filled in, two infrared entry magnetic positions need to be installed to detect entry and exit. Each person's passage time must be less than the door opening timeout, otherwise the device will automatically open the next time. For detailed instructions, please refer to the document "Summary of Judging Passage Functions (One Ticket for Multiple Passengers)" OrderCodeOptional, request the order number of the business, used for traffic judgment, and return the original value of the heartbeat during traffic. Maximum 16 bytes, supported starting from November 23, 2023 The red part of the response field is mandatory, and other parts can be added as needed. Note: The encrypted returned string must conform to the structure DATAS={} 
Traffic parameter selection table AcsRes ActIndex Action relay Not allowed to open 00 - Allow entry one 0 Open Lock A Allow to leave one one Open Lock B Control output one two Open Alarm call the police two 0 AlarmTurn off output three 0 Turn off Lock A Turn off output three one Turn off Lock B Turn off output three two Turn off Alarm All closed four X Turn off Lock A and Lock B Fully openone hundred x Open Lock A Lock B End of file! 2018-06-04