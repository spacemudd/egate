Cloud online double way access controller?Plus B version?TCP/IP Protocol This agreement is confidential documents, without permission shall not be copied or sent to other people.If you can't maintain the security of this document, please delete it.This agreement applies to online access controller!   2018-06-20
The working principle After swiping card on the access controller, real-time transmission to the back end server, the server process the received data, make a response to the controller, the controller according to the response to make corresponding responses, such as open the door. Equipment must keep communication between the server and network, can use TCP, Http protocol, this file is for TCP/IP protocol.The development steps1. Use the demo software to run the access control software, has a basic understanding and perceptual knowledge of the process of the access control management.2. On the basis of the understanding of software, view the instructions in communication protocol, has a roughly understand about the working process of the instruction.3. Understand all the key instructions of the communication protocol instructions.4. Understand the instruction execution process. The key instruction execution has successively.5. Master the basic structures of instruction, complete the basic function of instructions packaging.6. Complete response and handling of the state function with packaging function, for testing.7. Complete the simplest instructions such as open a door with packaging function, for testing.8. Complete the communication process framework.Key points: In development process to grasp the software communication data using caught tool, comparison, check the error data of the communication package.Communication work flow1. In the browser (chrome) login controller's IP address, modify connection mode:Client mode: controller connection server IP and communicate with the port;Server mode: the software connects the controller IP and port;2. The controller will send status and record information to software, software to make corresponding reply.3. In order to start of developing simply, reset the controller first, then connect, the controller will send only state information, the software to make response, the controller will be disconnected after more than 10 seconds if state information of controller doesn’t receive response.4. Send instructions to the controller software, such as open the door.5. Swipe, receiving swiping card event, reply this eventOperation Steps1. Modify the computer IP and controller for the same network segment, typically 192.168.0. X.2. Use the browser (chrome) open the IP address of the controller, the login account :admin  password:888888.  3. Enter the network Settings interface, according to your requirement to modify the parameters such as network address. If the need the controller connects to the software, you may need to modify the communication mode and server IP and port.4. Enable TCPIP communication function.5. Run the demo software for testing.6. Detailed reading this document to have the developing.7. In developing can use the network capture packet tools (such as Ethereal) to capture network data and protocol to have the compared developing.Minimum project needs to be done: heart rate data reception and response, swiping card data reception and response.
Instructions frame structurestructurecodedescriptiondescriptionlength(byte)Package headSTXstart bit0x021Randrandom numberretain1Commandinstructiondistinguish different instructions1Addressaddress1Doordoor No.1Length LData length lowThe length of the part of the data, if it is zero indicates no data section, access controller returns, high and low are  reverse1Length HData length high1dataDatadataInstruction contains data, some instructions don’t have the parts0..Npackage endCScheckView the following check algorithm1ETXend0x031Check algorithm	Check uses simple XOR operation way to operate all the data that in front of the check bytes then get the check value.CS = STX xor Rand xor Command xor Address xor Door xor Length L xor Length H xor Data[0] xor Data[1] xor Data[2] xor …. Ex: 02 AA 56 00 00 00 15 00 09 08 18 0C 07 0A 00 00 00 00 00 00 00 00 00 00 00 50 00 00 A3 03	0xA3 is check value that the XOR for all of the data from 0x02 to 0x00 that is in front of the 0xA3All of the instructions frame must meet the following requirements: 1. Meet the definition of the package head and end.2. Correct check value.3. The parameters of the corresponding function between the data part and accept instructions part of the controller should meet range boundaries.No record back instruction:Run successful: Data =06Run failed: Data =15Note:The length of Package head is 2 bytes, the 2 byte in the sending package and receiving package ,the high and low are interchange and opposite.The length field value that inside the agreement for each instruction is not fixed, such as instruction 0 x63 data length is not necessarily the 7. The length is changing, resolution protocol reference length check structure and calibration, and length is not absolute value. Like this agreement can be compatible with the previous version, meaning that the receiver need to ignore the back part of the extra. [All communication protocols are the same principles in the world]
instruction listNo.instructionnamedescription10x56Automatically upload status?heartbeatinstruction?receive status heartbeat20x53Automatically upload swiping card recordThe software control the device after swiping card30x73Control outputSoftware control the device initiative40x2COpen door 50x2DThe door normally open60x2EClose door70x2FLock door80x5ANo reading card90x07Time synchronization100x18Operate the alarm110x19Operate alarm 120x63  Set parameters130x04Reset access controller140xB1485 transmit data150x80Voice board - broadcast voice statements160x81LCD screen - Shows multi-line textCard number is an integer, default function of screen.170x82LCD screen - Shows multi-line textCard number is a string, the need to screen support180x83LCD screen - Single-line text display190x84LCD screen - Show integer NumbersMinimum project needs to be done: heart rate data reception and response, swiping card data reception and response.
Instruction: transmit access controller status.Command=0x56Device sends to the software:structurelengthdescriptionPackage head7Command=0x56—1backupTime 6Clock of the controller, from low to high: (date) (month) (year) minutes, year need add 2000Door state 1Bit5 whether the Exit is locked;Bit4 whether the Entry is locked;Bit1 exit status(door sensor and lock output are all off is closed.)Bit0 entry status (door sensor and lock output are all off is closed.);—1backupDirection control 1Bit1 exit is lockedBit0 entry is locked—1backupmodel number11 single doorRelay status1Bit2 alarm relay statusBit1 exit relay statusBit0 entry relay statusoutput2the status of all of the output portsbackup3version1Version of controller firmwareOEM code2 integer value?option?Serial number6Controller’s serial numberinput port2Bit11  reset jumperBit10 anti-dismantle Bit6-9 external input 1-4Bit5  fire alarm inputBit4  alarm inputBit3  door sensor(exit);  Bit2  door sensor(entry)Bit1  exit button;       Bit0  entry buttonIdentification10it can be changed in the controller’s web interface, the default one is serial numberTemperature22 groups temperature, the floating point value,  bring a decimalhumidity22 groups temperature, the floating point value,  bring a decimalVersion4Firmware Version.NC1Not usedpackage end2  Controller actively sends status, it will send it every 5 when the status changes 
Software response A:structurelengthdescriptionPackage head7customer code high1Customer code of access controller, the device that has this function, must response the correct code value.customer code low1package end2Software response B:structure  (byte) instructions 7 Address for select In or out, use for select screen and other dataClient code level 1 The client code for the controller, the device with this function must respond to the correct code value Client code low 1 Whether to open the door 1 Bit7 use for control output.0x00 do nothing, 0x81 open , 0x80 not openrelay 1 Output relay number, starting from 0. 0 enter the door, 1 go out and 2 alarmOpen time 2 The time of operation of the  relay output,in seconds. Screen1 2019-07-05 Bit7=1 use LCD to show.Bit0-5 page image of one screen. Address of head select sereen.Keep the time 1 After how many seconds the display remains, the default home page is displayed.  If it's 0, it doesn't switch. 1The card number 18 Used to display the card number string, 0 means nothing. voice 40A string of sounds used for voice broadcasting, 0 means nothing. The name 16 The name string used for display, 0 means nothing. The event 32 The event string used for display, 0 means nothing. time 20 The time string used for display, 0 means nothing. Package  tail 2 
Instruction: transmit swiping card recordCommand=0x53Device sends to software:structurelengthdescriptionpackage head7Instruction is 0x53Serial number6controller’s serial number Mark10The mark that modified in the web interface is defaulted as the controller serial number.Reader10=entry,1=exit; Used to determine directionData Source1 Data source for this request(support from 2023-11-10, version:4.2.127)  0=WG Reader; 1=RS232; 2=485; 5=USB; 6=232 Converter;  7=Button; 9=Network—4backupData type10=ordinary card   1= 232 port inputs data string, such as QR code 2=password   3=button   6=second id card data9=base64 data10=Finger data  11=vein finger  12=RFID  13=FaceSystem time16Previous seven are effective, year month day hour minute second week Card number44byte card numberdataXThe transmit data, card number,QR Code,face,vein data and so on, not exceeding 2048package end2swiping card record is the controller uploads and process actively, software responses.If data is face, it will send until end of data. Address =0 means the package is last one, then the server should responseSoftware response:structurelengthdescriptionPackage head7Instruction is 0x54whether open door1Whether through validation, if through then open the lockRelay1The output relay number starts from 0. 0 entry, 1 exit , 2 alarm.Open time2Output relay action time, in secondsScreen1 2019-07-05 Bit7=1 use LCD to show.Bit0-5 page image of one screen. Address of head select screen.Keep time1How much seconds the display keeps then shows the default home page. if 0, there is no switch1 Card 18used for showing the card number character string, if 0 means no haveVoice40Voice character string that used for voice broadcast, if 0 means no haveName16Name character string that used for show name, if 0 means no haveEvent32Event character string that used for showing, if 0 means no haveTime20Time character string that used for showing, if 0 means no havepackage end2Device reply againstructurelengthdescriptionPackage head7Instruction is 0x54Response10x06:successpackage end2
Instruction: transmit alarm recordCommand=0x55Device sends to software:structurelengthdescriptionPackage head7Instruction is 0x55Serial number6controller’s serial number Mark10The mark that modified in the web interface is defaulted as the controller serial number.Card reader1Data card reader source,0-3,0=232 or Read A,1=232exit or Reader B,2=485A,3=485B—5backupData type15=alarm, not swiping card and so on to collect data type eventSystem time16Previous seven are effective, year month day hour minute second week Event number1View the data base table TEventType in databaseWhether pass1Whether this event is allow to pass.-2backupdataXNote, not exceeding 100package end2Alarm record is the controller uploads and process actively, software cannot responses, if responses, the same as the swiping card responses.
Instruction: control output Command=0x73Software sends instruction actively:structurelengthdescriptionPackage head7Address for select In or out, use for select screen and other datawhether open door1Whether open the lockRelay1The output relay number starts from 0. 0 entry ,1 exit , 2 alarmOpen time2Output relay action time, in secondsScreen1 2019-07-05  Bit7=1 use LCD to show.Bit0-5 page image of one screen. Address of head select screen.Keep time1How much seconds the display keeps then shows the default home page. if 0, there is no switch1Card18used for showing the card number character string, if 0 means no haveVoice40Voice character string that used for voice broadcast, if 0 means no haveName16Name character string that used for show name, if 0 means no haveEvent32Event character string that used for showing, if 0 means no haveTime20Time character string that used for showing, if 0 means no havepackage end2Device replystructurelengthdescriptionPackage head7Instruction is 0x73response10x06:successpackage end2Instruction: reset controllerCommand=0x04Software sends to device:structurelengthdescriptionPackage head7Command=0x04,package end2This instruction need longer time than other instructions.Device response:structurelengthdescriptionPackage head7Command=0x04response10x06:successpackage end2
Instruction: set parametersCommand=0x63Software sends to device:structurelengthdescriptionPackage head7Command=0x63Open time 2Open time, low is in the front.Open over time1The open over time detector time range after closed the door.Open too long to alarm1After the door open over time, it will produce alarm record.Alarm type1Alarm type, which alarms produce the alarm output; can choose more than one.0x01 door alarm 0x02 open time too long to alarm.Trigger alarm time 2The output alarm time when alarm item is triggered. Low is in the front.Fire alarm time2The duration of fire alarm input trigger the output, low is in the front.input alarm time2alarm input trigger alarm output, the duration of outputany input open door11 Any input is to open the door Anti-follow11 close door sensor, close the door immediately.Emergency password8Character string, 0 ending, input password is this character string then open the door.Emergency id18Character string, 0 ending, ID number is this character string then open the door.Emergency card10Character string, 0 ending, the swiping card number is character string then open the door.Emergency character string20Character string, 0 ending, input the front of this character string if including this character string then open the door immediately, such as scan QR codepackage end2Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2
Instruction: time synchronizationCommand=0x07Software sends to device:structurelengthdescriptionPackage head7Command=0x07,Time7Order: second minute hour week day month year ,second in the former, decimal;7 means Saturday; year 10 means 2010, 24 hours a daypackage end2Note: time data according to the decimal representation, use Numbers, not character.Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2Instruction: operate alarm outputCommand=0x18 Software sends to device:structurelengthdescriptionPackage head7Command=0x18whether shut down the alarm1Non-zero closed alarm, zero output alarm; alarm time is the alarm time in  the controller parameterswhether normally open1whether to keep alarm output after turning onpackage end2Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2
Instruction: operate fire alarm outputCommand=0x19 Software sends to device:structurelengthdescriptionPackage head7Command=0x19whether shut down the fire alarm1bigger than zero closed alarm, zero output fire alarm; fire alarm time is the fire alarm time in the controller parameterswhether normally open1whether to keep fire alarm output after turning onpackage end2Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2 Instruction: lock doorCommand=0x2FSoftware sends to device:structurelengthdescriptionPackage head7Door address means relay, 1-3means 3 relaysLock status1Non-0 means locked, 0 means unlockingpackage end2Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2Instruction: open door Command=0x2CSoftware sends to device:structurelengthdescriptionPackage head7Door address means relay, 1-3means 3 relayspackage end2Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2
Instruction: door open normallyCommand=0x2DSoftware sends to device:structurelengthdescriptionPackage head7Door address means relay,1-3means 3 relayspackage end2Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2Instruction:close door Command=0x2ESoftware sends to device:structurelengthdescriptionPackage head7Door address means the relay of the exit button, 1-3 means 3 relays.package end2Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2Instruction: No reading card Command=0x5ATo prohibit some directions cannot read card, used to shut down the pass function of the corresponding direction.Software sends to device:structurelengthdescriptionPackage head7Command=0x5A—1backupCard reader 10-1,means the card reader that can be used or prohibition of use—1backupWhether pass11 can’t pass,prohibition,0 means can passpackage end2device response:structurelengthdescriptionPackage head7response10x06:successpackage end2
Instruction: 485 transmit dataCommand=0xB1By this instruction to send data to 485 or 232 port .Software send to device, device send out the data part by 485.structurelengthdescriptionPackage head7The Address of the Package head, means the sending place,2 means the first external 485,3 means the second external 485.Forwarded data1-1300The data sent from device by 485package end2The 485 of device received the data and then transmit the data package to software:structurelengthdescriptionPackage head7The Address of the Package head, means the 485 port of sending, 2 means the first external 485, 3 means the second external 485.Data of 4851-1300The data that received by 485 portpackage end2Need to select "485 data transmit to instruction0xB1”In the serial port configuration   Instruction: voice board-Broadcast voice and statementCommand=0x80Through this instruction, send data to external 485 port, transmit to voice module, the voice module to broadcast.Baud rate fixed to 9600, need to open the controller web page port serial configuration "output to voice board (baud rate, 9600)".Device sends to software:structurelengthdescriptionPackage head7address1Voice board’s number, the default is 0.Voice length1Statement length, calculated on byte, no greater than 242.—1backupbroadcast statement 1-242character string contentpackage end2Device response:structurelengthdescriptionPackage head7response10x06:successpackage end2
 Instruction: LCD screen - Shows multiline textCommand=0x82Through this instruction, send data to the first external 485 port, transmit to LCD screen to show.Baud rate fixed to 9600, need to open the controller web page port serial configuration “output to LCD screen (baud rate, 9600)".Device sends to software:structurelengthdescriptionPackage head7Address for select In or out, use for select screen and other dataTime to homepage1how long the page back to the default home page interface ,in secondspage1 Whether through, used to display different background images. 6 through, 7 d through, and other omissions Card18The card number character string will to show, need LCD screen card number tags as a character stringName 16the name character string will be showedEvent 40the events character string will be showedTime 20the time character string will be showedpackage end2Device response:structurelength(byte)descriptionPackage head7response10x06:successpackage end2Instruction: LCD screen - Single-line text displayCommand=0x83Through this instruction, send data to External 485 port, transmit to LCD screen to show a line of words.You can show any effect you need by this instruction through the custom LCD screen.Baud rate fixed to 9600, need to open the controller web page port serial configuration “output to LCD screen (baud rate, 9600)".Device sends to software:structurelengthdescriptionPackage head7Address for select In or out, use for select screen and other datapage1 Whether through, used to display different background images. 6 through, 7 d through, and other omissions address1Display place, the option value are 0x55 0x66 0x77 0x88Show time1Display content retain time, in seconds, if over time shows the default interface.show content32Variable length, the content character string will be showed.package end2Device response:structurelength(byte)descriptionPackage head7response10x06:successpackage end2The end..7